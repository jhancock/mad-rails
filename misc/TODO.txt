turn on mihudie BankOfDudley card
fix PayPal mihudie and shellshadow accounts.  might need cc info updated
fix BoD personal debit card.

DONE fix Georgia corp registration for mihudie 
   and shellshadow.
   fix paypal mihudie account.  get mihudie EIN.  Call Mom
sign up for Alipay - Mihudie LLC
pay for scoutapp - Need working credit card

braintree doesn't have Chinese UI.  See if my PayPal account handles UnionPay

email TODOs...see below

Next
-----
reissue namecheap SSL cert.  update nginx conf: remove SSLv3

do I need to trim blank on fields such as email and password?

write scripts to migrate data for duplicate books, users, bookmarks

change Book finder to use scoping http://mongoid.org/en/mongoid/docs/querying.html#scoping

book_controller#read needs permission checks and redirects to register/purchase

finish all user & password behavior
   registered email
   send_email_verify (for register)
    account page.  
      verify email
      logout link 
      recent bookmarks
      manage bookmarks link
      change_password link
      change_email link
      set theme link
      premium to date
      referral link if not used

    send_email_verify link
      log event for email sent - email handler should do this
      log event when verified
        user.email_verified = Time.now
    register_email_verify - need to give month free and give month free to referrer
    email_change_verify

    on login failure, be sure to show user password-reset link

    bookmarks page - page through and remove bookmarks
       BooksController#read needs to set bookmark
    change_password page
    password_reset_request
    password_reset_request_post
    password_reset page
    change_email page
    change_email_post
    change_email_verify
    set theme page
    force_ssl on account/password_change, password_reset_reuqest and password_reset
    DONE test mods to user login, LoginLog, logout kills cookie, register stores ip, etc
    logout link in menu bar if not mobile.  only on account page for mobile
    add shortcuts to account behavior on account nav list
    add bookmarks to bookmarks tracks list

v1.0 - tracks and bookmarks in one integrated menu item.  Need a name for it.  User can get to pure bookmarks view from account menu.  This leaves room for author menu at end (in future version).  author can have quick access to their book stats ;) and maybe post messages on mobile.  A controller#action knows its tracks: an array of k,v pairs.  key is URL.  value is list item name.

handle error in search if nothing found, such as empty search.

if book is offline, gracefully return user to home or prior page with error message.

fix admin_users views

***********************************
Hand over to Andrea for translation
***********************************

nginx
------
remove SSLv3.  requires reconfiginzing old browsers and serving a page from nginx that recommends the use to install Firefox.

fix nginx conf so there is a default server that returns nothing.  This will keep people from hitting it with the ip address.
see: https://github.com/perusio/piwik-nginx/blob/master/sites-available/000-default

see about adding spdy to nginx ssl
http://www.nginxtips.com/what-is-spdy/
http://www.nginxtips.com/how-to-install-and-configure-spdy-on-nginx/
-------

set nginx/passenger in maintainance mode while I'm upgrading
http://tom.meinlschmidt.org/2013/10/15/rails-passenger-nginx-maintenance-mode/

ensure session does not expire between opening and closing browser.

rails logrotate not working

see about mongodb logrotate

_mhd_session cookie shows in firefox for both dev.mihudie.com and mihudie.com at the same time.  

put hashids in seperate file in lib, not as gem

SEO - Baidu cares about changes on page titles
    add schema.org microdata
    http://www.google.com/webmasters/tools/richsnippets
    http://www.heppnetz.de/projects/goodrelations/

optimize: _book.html.haml can use a pre-rendered <li>.  store it in book data just like genre_tags_pp
lazy save pre-rendered book li, genre_tags_pp and summary_html if doesn't exist

script to ensure all books have li, genre_tags_pp and summary_html

Andrea - test on iPad and Android phones.  Test on popular Chinese browsers.

add PayPal Express
https://github.com/paypal/PayPal-Ruby-SDK
https://devtools-paypal.com/integrationwizard/
https://github.com/paypal/PayPal-Ruby-SDK/blob/master/samples/payment/create_with_paypal.rb
https://support.braintreepayments.com/customer/portal/articles/1593802-paypal-setup-guide
https://developers.braintreepayments.com/javascript+ruby/guides/paypal
http://stackoverflow.com/questions/14316426/is-there-a-paypal-ipn-code-sample-for-ruby-on-rails

add Alipay


new model
---------- 
  User gets 1 month premium_to on registration.  After they validate their email.
change premium attribute to premium_at. 
  Two week after, send user email asking if they've enjoyed mihudie.  If they would like to invite a friend, they can use the link in this email and both they and their friend gets another month free.  Try if Mandrill can send the two-week-later email when the validate-success mail is sent. 

  For existing users, create a new email to notice them of their free month (when I get around to writing a script to roll through existing users).  These users must verify their email too!  We can fix this by having a seperate landing page for this email to claim their referral URL.  Set their new premium_to and send them an email as well two weeks later to let them invite a friend.

  A user may buy a full year premium (added to their existing time) for 60 rmb or $10 USD. 


Andrea
-------
user legal agreement.  include backyard access rules and refund fee rules.

Andrea needs to write new emails and help translate site messages
--------

admin page v1.0
  elaticsearch calls on book change.  
  grant premium_to access - amount of time or specific date
  	send email to user unless checkbox is selected to not

sitemap.xml script
  EMAIL Should sitemap include old book links with objectId?
  EMAIL Should canonical url be the one with ID or author/title?

review email template.  It may not be repsonsive for email readers.
   add my own unsubscribe link to email template.  the default one is too prominent.
   email footer has  mihudie address which links to map on iPhone.  See if this can be removed

setup exception_notificaion and test. 
  see if we can write exceptions to file and have scout pick them up.  

setup tarsnap on vr1
  check money in tarsnap account


cleanup email TODOs
--------------------
email Wiley Stuckey
see about NZ telecom HR director.  See if he's the same guy I met
email Aaron Bellingham
email Richard Vaughan with updated cv
email Rowan's friend
email Nick
email Andrew Morrow
send cv to trademe saved jobs

DONE need an Action Link.  This is an anchor styled so the user knows its an action.  Bigger and bold but not a button.  Need this for account page links like password_change, manage bookmarks, etc.

DONE update rails to 4.1.7

DONE _book.haml.html.  author span is only showing on mobile.  no way to show author on desktop or tablet.

DONE  books_offline_history collection, fix model in 2.0. old data not needed.  mongo collection books_offline_history is storing the book_id attribute as a String.  This is inconsistent with how Bookmarks store book_id as ObjectId.  Since there are only 8 of these docs, we can hand migrate to an ObjectId pre-launch.

DONE commpare list.haml.html & index.haml.html & tag.haml.html.  refactor?  can I make a column or flow list of books and authors?

DONE for next/prev page on lists, try using javascript technique used for book theme and top buttons.

DONE post-production or pre-DB-import: drop event_log, mail_log

DONE Write scripts for DB migration.  test import and scripts

DONE - PAY DREAMHOST

DONE reading layout.  The only diff is
     = render 'layouts/reading_menu'
     refactor? or use rails content_for?

DONE set theme behavior.  js needs to set cookie mhd_theme value to be the theme class.  server can ignore this cookie.

DONE better flash notices.  better form errors. 

DONE setup logrotation for rails. rotate daily.  keep 30 days.

DONE install goaccess.  basic tests.

DONE review elasticsearch config on vr1.  should be only 1 shard?  and not look for other nodes?  and only listen on localhost?

DONE Pay SREE ;)

DONE clean up elastic search / logstash docs and commit.

DONE set email text field to type understood by iPhone

DONE wire $1200 from HSBC to Bank of Dudley

DONE elasticsearch
  DONE find out how to search with offline_at attribute
  DONE search highlighting - see http://www.sitepoint.com/full-text-search-rails-elasticsearch/
  DONE change /search to get.  add no_follow to the link
  DONE scripts to delete and rebuild index

DONE Add ElasticSearch basics

DONE - UserEvents - need to track user events:  money added, points awarded, backyard access given, point deducted for purchase, etc.  Keep these seperate from LoginEvents and SystemEvents.  Move user email events to UserEvents.  Rename EventLog to SystemEvents

DONE EMAIL Scout Mongodb plugin reporting size of storage around 400mb, but the files in /var/lib/mongodb are over 1G.  Send support email.

DONE EMAIL Scout Rails plugin is properly triggering alert when over 500 request/minute.  But when I go to the web console, the history shows almost nothing.  I don't see the spike.

DONE EMAIL Scout seems to be checking my URL more than every one minute

DONE need to log login failures

DONE ensure session cookie is destroyed on logout

DONE geoip - only store user.cn and city
  set cn in session cookie.  then we will have for all visitors.
  store in db on login/register.
  whenever it is not in the cookie, set it and store in db if user is logged in.

DONE create LoginLog.  track user logins by ip

DONE - use form_builders

DONE nginx static file serving.  set expire to forever.  turn gzip_static on

DONE force SSL for login, register

DONE setup dev and vr1 nginx for mihudie.com with SSL cert.  use OS X hosts to point ot it.  change lin1 nginx to accept lin1.mihudie.com.

DONE turn off redis-server on dev

DONE nginx logs should be seperate for mihudie and shellshadow.  added mihudie.access.log. and mihudie.error.log.  shellshadow logs go to normal access.log and error.log

DONE use suckerpunch instead of sidekiq
DONE record suckerpunch email sends so I can verify the integrity of the backround processes.

DONE if User has a bad cookie, remove the cookie.  Test case:  I'm an admin user and login as myself.  I go to the admin page to remove myself.  After removing, I get redirected to the home page.  My cookie should get deleted when the home page renders as it contains an invalid user id.

DONE see nginx error.log.  when passenger starts, ssh-keychain causes an error.

DONE - Its set to Weekly, not daily. ;) find out why nginx log don't seem to rotate

DONE remove old bitbucket rsa key.  new key is bitbucket_jhancock
DONE find solution for NTP clock drift.  What is resyncing effect on mongodb?

DONE setup vr.org vm in HK
	setup vr1.mihudie.com and include basic http auth
DONE come up with solution for storing passwords, API keys out of git
DONE add mandrill
DONE add ENV vars to .bashrc and test.
DONE move ENV vars to ~/.rails_env
DONE create admin page to delete a user, so I can re-register.
DONE create scripts to GRANT/REVOKE admin
DONE get rid of login-help link at top.  only need login, register || account, logout

DONE send Fly notes on UX.  Set a date for v1
DONE 2 more namecheap emails to confirm
DONE meet Julian/Fly Wednesday lunch
DONE move mihudie.com DNS from linode to namecheap
	DONE verify critsend DKIM and SPF
HOLD move shellshadow email to fastmail.fm
DONE setup tarsnap on vr1 - backup ss archives
DONE turn off us1
DONE check other DNS records at m5hosting.  move any to namecheap.
DONE handle Merb::Config[:mihudie][:suppress_tags] in public lists
DONE setup shellshadow static site under nginx on vr1.  ensure all assets are archived on vr1.
DONE remove shellshadow.com from air /etc/hosts
DONE put shellshadow code on bitbucket.
DONE move shellshadow.com DNS from m5hosting to namecheap

