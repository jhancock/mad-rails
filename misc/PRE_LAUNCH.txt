PRE_LAUNCH.txt
===============
# migrate data
rails r lib/scripts/migrate_v2.0.rb  ~/mongo_dump/lin1-20141102082738.tar.gz ~/migrate_v2.0 > ~/migrate_v2.0.txt
# things to add to migrate_v2.0.js:
# unset Book.offline_at if it is nil
# unset :password_reset_code and :password_reset_at
# set_public_id for any user without one
# scripts to handle duplicate books, bookmarks, users.  
books 230 dups, 228 have same origin
  keep most recent (based on updated_at).  mark duplicate with duplicate attribute that has value of the kept version.  
  add read_count of dup to kept book
  update books_controller#read. If user tries to retreive by old URL for the dup, 301  redirect to the canonical of the kept version.
bookmarks 1303 dups, 834 have same chunk
  keep most recent based on updated_at.  delete other.
users 24 dups
  keep most recent
# change user#email_error to email_bounced_at (if old user has email_error, set email_bounced_at to user#updated_at
# ensure all books have detail_li, tag_names, tag_names_pp and summary_html

# remove indexes
rake db:mongoid:remove_indexes

# dump db

# change index defs (the ones commented out) of user, bookmark

# import db

# create indexes.
rake db:mongoid:create_indexes

# set mongodb profiling level
use mhd_development || use mhd_production
db.setProfilingLevel(2)

index elastic search.  delete_and_reindex_book_search.rb

create sitemap.xml.  create script

remove critsend from SPF and DKIM

DNS stuff - lin1 to vr1

verify SSL at https://www.ssllabs.com/

mandrill
	ensure production API key
	money in mandrill account
	ensure mandrill DKIM and SPF

remove basic auth from Rails
       ApplicationController before_action :http_auth

nginx.conf
	change passenger_pre_start http://vr1.mihudie.com/; 
	    to passenger_pre_start http://mihudie.com/; 

scoutapp
       change URL monitoring to mihudie.com and remove http auth params

nginx sites-available mihudie.com
	remove server_name vr1.mihudie.com;

DONE nginx mihudie.com config location for static files needs to have expires max working.  It may be commeted out pre-production.

nginx gzip js and css files
      gzip -1 -c mihudie.css > mihudie.css.gz
      gzip -1 -c mihudie.js > mihudie.js.gz

DONE ensure www.mihudie.com redirects to mihudie.com
	see shellshadow.com for example

v1.1 ensure nginx request without domain is default server and returns nothing



