PRE_LAUNCH.txt
===============
# migrate data
rails r lib/scripts/migrate_v2.0.rb  ~/mongo_dump/lin1-20141102082738.tar.gz ~/migrate_v2.0 > ~/migrate_v2.0.txt

# things to add to migrate_v2.0.js:

# unset Book :offline_at if it is nil and then unset :offline_reason
# unset all User :password_reset_code and :password_reset_at
# unset all Book :tag_names.  Keep tags, tag_names_pp
# unset all Book :email_error
# ensure all Book :tags are an array.. No nil allowed
# ensure all Book :read_count and :unique_read_count are set to an integer

# set_public_id for any user without one.  books.each  book.create_public_id; book.save

# scripts to handle duplicate books, bookmarks, users.  

bookmarks 1303 dups, 834 have same chunk
  keep most recent based on updated_at.  delete other.

users 24 dups
  keep most recent based on updated_at.  delete other.

DONE (lazy handling at run-time) books 230 dups, 228 have same origin
    keep most recent (based on updated_at).  mark duplicate with duplicate attribute that has id of the kept version.  
    add read_count of dup to kept book
    update bookmarks to point to master book

### END SCRIPTS ###

# Bookmark.set_pp_all
# Book.set_detail_li_all

# remove indexes
rake db:mongoid:remove_indexes

# dump db

# change index defs (the ones commented out) of user, bookmark

# import db

# create indexes.
rake db:mongoid:create_indexes

# set mongodb profiling level
use mhd_development || use mhd_production
db.setProfilingLevel(2)

index elastic search.  reindex_book_search.rb

create sitemap.xml.  create_sitemap.rb

remove critsend from SPF and DKIM

DNS stuff - lin1 to vr1
  remove critsend DKIM and SPF

verify SSL at https://www.ssllabs.com/

mandrill
  ensure production API key
  money in mandrill account
  DONE ensure mandrill DKIM and SPF
  change webhook urls to match mihudie.com, not vr1.mihudie.com

remove basic auth from Rails
  ApplicationController before_action :http_auth

nginx.conf
  change passenger_pre_start http://vr1.mihudie.com/; 
      to passenger_pre_start http://mihudie.com/; 

scoutapp
  change URL monitoring to mihudie.com and remove http auth params

nginx sites-available mihudie.com
  remove server_name vr1.mihudie.com;

DONE nginx mihudie.com config location for static files needs to have expires max working.  It may be commeted out pre-production.

# rails log must be owned by group syslog or it won't rotate
rm ~/rails/log/*
touch ~/rails/log/production.log
sudo chown mhd:syslog ~/rails/log/production.log

nginx gzip js and css files
      gzip -1 -c mihudie.css > mihudie.css.gz
      gzip -1 -c mihudie.js > mihudie.js.gz


POST_LAUNCH
-------------
run SSL tests  testssl.com?

verify http working
curl -I http://mihudie.com

test microdata
http://www.google.com/webmasters/tools/richsnippets

submit site to baidu, google, bing, yahoo




